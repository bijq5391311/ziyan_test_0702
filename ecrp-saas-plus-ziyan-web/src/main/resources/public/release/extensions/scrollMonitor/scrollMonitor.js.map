{"version":3,"sources":["scrollMonitor/scrollMonitor.js"],"names":["factory","define","amd","module","exports","window","scrollMonitor","calculateViewport","viewportTop","scrollTop","viewportBottom","viewportHeight","documentHeight","getDocumentHeight","previousDocumentHeight","calculateViewportI","watchers","length","recalculateLocation","recalculateWatchLocationsAndTrigger","getViewportHeight","updateAndTriggerWatchers","debouncedRecalcuateAndTrigger","clearTimeout","recalculateAndTriggerTimer","setTimeout","updateAndTriggerWatchersI","update","triggerCallbacks","ElementWatcher","watchItem","offsets","triggerCallbackArray","listeners","listenerToTriggerListI","listener","callback","call","self","latestEvent","isOne","splice","this","top","bottom","defaultOffsets","callbacks","i","j","eventTypes","locked","wasInViewport","wasFullyInViewport","wasAboveViewport","wasBelowViewport","isInViewport","ENTERVIEWPORT","isFullyInViewport","FULLYENTERVIEWPORT","isAboveViewport","isBelowViewport","VISIBILITYCHANGE","PARTIALLYEXITVIEWPORT","EXITVIEWPORT","STATECHANGE","previousTop","previousBottom","nodeName","cachedDisplay","style","display","boundingRect","getBoundingClientRect","height","undefined","LOCATIONCHANGE","scrollMonitorListener","event","pageYOffset","document","documentElement","body","innerHeight","clientHeight","Math","max","scrollHeight","offsetHeight","prototype","on","Error","join","push","off","item","one","recalculateSize","destroy","index","indexOf","lock","unlock","eventHandlerFactory","type","e","$","addEventListener","attachEvent","beget","create","element","querySelector","watcher","recalculateLocations"],"mappings":"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","file":"scrollMonitor.js","sourcesContent":["(function( factory ) {\n\tif (typeof define !== 'undefined' && define.amd) {\n\t\tdefine([], factory);\n\t} else if (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = factory();\n\t} else {\n\t\twindow.scrollMonitor = factory();\n\t}\n})(function() {\n\n\tvar scrollTop = function() {\n\t\treturn window.pageYOffset ||\n\t\t\t(document.documentElement && document.documentElement.scrollTop) ||\n\t\t\tdocument.body.scrollTop;\n\t};\n\n\tvar exports = {};\n\n\tvar watchers = [];\n\n\tvar VISIBILITYCHANGE = 'visibilityChange';\n\tvar ENTERVIEWPORT = 'enterViewport';\n\tvar FULLYENTERVIEWPORT = 'fullyEnterViewport';\n\tvar EXITVIEWPORT = 'exitViewport';\n\tvar PARTIALLYEXITVIEWPORT = 'partiallyExitViewport';\n\tvar LOCATIONCHANGE = 'locationChange';\n\tvar STATECHANGE = 'stateChange';\n\n\tvar eventTypes = [\n\t\tVISIBILITYCHANGE,\n\t\tENTERVIEWPORT,\n\t\tFULLYENTERVIEWPORT,\n\t\tEXITVIEWPORT,\n\t\tPARTIALLYEXITVIEWPORT,\n\t\tLOCATIONCHANGE,\n\t\tSTATECHANGE\n\t];\n\n\tvar defaultOffsets = {top: 0, bottom: 0};\n\n\tvar getViewportHeight = function() {\n\t\treturn window.innerHeight || document.documentElement.clientHeight;\n\t};\n\n\tvar getDocumentHeight = function() {\n\t\t// jQuery approach\n\t\t// whichever is greatest\n\t\treturn Math.max(\n\t\t\tdocument.body.scrollHeight, document.documentElement.scrollHeight,\n\t\t\tdocument.body.offsetHeight, document.documentElement.offsetHeight,\n\t\t\tdocument.documentElement.clientHeight\n\t\t);\n\t};\n\n\texports.viewportTop = null;\n\texports.viewportBottom = null;\n\texports.documentHeight = null;\n\texports.viewportHeight = getViewportHeight();\n\n\tvar previousDocumentHeight;\n\tvar latestEvent;\n\n\tvar calculateViewportI;\n\tfunction calculateViewport() {\n\t\texports.viewportTop = scrollTop();\n\t\texports.viewportBottom = exports.viewportTop + exports.viewportHeight;\n\t\texports.documentHeight = getDocumentHeight();\n\t\tif (exports.documentHeight !== previousDocumentHeight) {\n\t\t\tcalculateViewportI = watchers.length;\n\t\t\twhile( calculateViewportI-- ) {\n\t\t\t\twatchers[calculateViewportI].recalculateLocation();\n\t\t\t}\n\t\t\tpreviousDocumentHeight = exports.documentHeight;\n\t\t}\n\t}\n\n\tfunction recalculateWatchLocationsAndTrigger() {\n\t\texports.viewportHeight = getViewportHeight();\n\t\tcalculateViewport();\n\t\tupdateAndTriggerWatchers();\n\t}\n\n\tvar recalculateAndTriggerTimer;\n\tfunction debouncedRecalcuateAndTrigger() {\n\t\tclearTimeout(recalculateAndTriggerTimer);\n\t\trecalculateAndTriggerTimer = setTimeout( recalculateWatchLocationsAndTrigger, 100 );\n\t}\n\n\tvar updateAndTriggerWatchersI;\n\tfunction updateAndTriggerWatchers() {\n\t\t// update all watchers then trigger the events so one can rely on another being up to date.\n\t\tupdateAndTriggerWatchersI = watchers.length;\n\t\twhile( updateAndTriggerWatchersI-- ) {\n\t\t\twatchers[updateAndTriggerWatchersI].update();\n\t\t}\n\n\t\tupdateAndTriggerWatchersI = watchers.length;\n\t\twhile( updateAndTriggerWatchersI-- ) {\n\t\t\twatchers[updateAndTriggerWatchersI].triggerCallbacks();\n\t\t}\n\n\t}\n\n\tfunction ElementWatcher( watchItem, offsets ) {\n\t\tvar self = this;\n\n\t\tthis.watchItem = watchItem;\n\n\t\tif (!offsets) {\n\t\t\tthis.offsets = defaultOffsets;\n\t\t} else if (offsets === +offsets) {\n\t\t\tthis.offsets = {top: offsets, bottom: offsets};\n\t\t} else {\n\t\t\tthis.offsets = {\n\t\t\t\ttop: offsets.top || defaultOffsets.top,\n\t\t\t\tbottom: offsets.bottom || defaultOffsets.bottom\n\t\t\t};\n\t\t}\n\n\t\tthis.callbacks = {}; // {callback: function, isOne: true }\n\n\t\tfor (var i = 0, j = eventTypes.length; i < j; i++) {\n\t\t\tself.callbacks[eventTypes[i]] = [];\n\t\t}\n\n\t\tthis.locked = false;\n\n\t\tvar wasInViewport;\n\t\tvar wasFullyInViewport;\n\t\tvar wasAboveViewport;\n\t\tvar wasBelowViewport;\n\n\t\tvar listenerToTriggerListI;\n\t\tvar listener;\n\t\tfunction triggerCallbackArray( listeners ) {\n\t\t\tif (listeners.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tlistenerToTriggerListI = listeners.length;\n\t\t\twhile( listenerToTriggerListI-- ) {\n\t\t\t\tlistener = listeners[listenerToTriggerListI];\n\t\t\t\tlistener.callback.call( self, latestEvent );\n\t\t\t\tif (listener.isOne) {\n\t\t\t\t\tlisteners.splice(listenerToTriggerListI, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.triggerCallbacks = function triggerCallbacks() {\n\n\t\t\tif (this.isInViewport && !wasInViewport) {\n\t\t\t\ttriggerCallbackArray( this.callbacks[ENTERVIEWPORT] );\n\t\t\t}\n\t\t\tif (this.isFullyInViewport && !wasFullyInViewport) {\n\t\t\t\ttriggerCallbackArray( this.callbacks[FULLYENTERVIEWPORT] );\n\t\t\t}\n\n\n\t\t\tif (this.isAboveViewport !== wasAboveViewport &&\n\t\t\t\tthis.isBelowViewport !== wasBelowViewport) {\n\n\t\t\t\ttriggerCallbackArray( this.callbacks[VISIBILITYCHANGE] );\n\n\t\t\t\t// if you skip completely past this element\n\t\t\t\tif (!wasFullyInViewport && !this.isFullyInViewport) {\n\t\t\t\t\ttriggerCallbackArray( this.callbacks[FULLYENTERVIEWPORT] );\n\t\t\t\t\ttriggerCallbackArray( this.callbacks[PARTIALLYEXITVIEWPORT] );\n\t\t\t\t}\n\t\t\t\tif (!wasInViewport && !this.isInViewport) {\n\t\t\t\t\ttriggerCallbackArray( this.callbacks[ENTERVIEWPORT] );\n\t\t\t\t\ttriggerCallbackArray( this.callbacks[EXITVIEWPORT] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.isFullyInViewport && wasFullyInViewport) {\n\t\t\t\ttriggerCallbackArray( this.callbacks[PARTIALLYEXITVIEWPORT] );\n\t\t\t}\n\t\t\tif (!this.isInViewport && wasInViewport) {\n\t\t\t\ttriggerCallbackArray( this.callbacks[EXITVIEWPORT] );\n\t\t\t}\n\t\t\tif (this.isInViewport !== wasInViewport) {\n\t\t\t\ttriggerCallbackArray( this.callbacks[VISIBILITYCHANGE] );\n\t\t\t}\n\t\t\tswitch( true ) {\n\t\t\t\tcase wasInViewport !== this.isInViewport:\n\t\t\t\tcase wasFullyInViewport !== this.isFullyInViewport:\n\t\t\t\tcase wasAboveViewport !== this.isAboveViewport:\n\t\t\t\tcase wasBelowViewport !== this.isBelowViewport:\n\t\t\t\t\ttriggerCallbackArray( this.callbacks[STATECHANGE] );\n\t\t\t}\n\n\t\t\twasInViewport = this.isInViewport;\n\t\t\twasFullyInViewport = this.isFullyInViewport;\n\t\t\twasAboveViewport = this.isAboveViewport;\n\t\t\twasBelowViewport = this.isBelowViewport;\n\n\t\t};\n\n\t\tthis.recalculateLocation = function() {\n\t\t\tif (this.locked) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar previousTop = this.top;\n\t\t\tvar previousBottom = this.bottom;\n\t\t\tif (this.watchItem.nodeName) { // a dom element\n\t\t\t\tvar cachedDisplay = this.watchItem.style.display;\n\t\t\t\tif (cachedDisplay === 'none') {\n\t\t\t\t\tthis.watchItem.style.display = '';\n\t\t\t\t}\n\n\t\t\t\tvar boundingRect = this.watchItem.getBoundingClientRect();\n\t\t\t\tthis.top = boundingRect.top + exports.viewportTop;\n\t\t\t\tthis.bottom = boundingRect.bottom + exports.viewportTop;\n\n\t\t\t\tif (cachedDisplay === 'none') {\n\t\t\t\t\tthis.watchItem.style.display = cachedDisplay;\n\t\t\t\t}\n\n\t\t\t} else if (this.watchItem === +this.watchItem) { // number\n\t\t\t\tif (this.watchItem > 0) {\n\t\t\t\t\tthis.top = this.bottom = this.watchItem;\n\t\t\t\t} else {\n\t\t\t\t\tthis.top = this.bottom = exports.documentHeight - this.watchItem;\n\t\t\t\t}\n\n\t\t\t} else { // an object with a top and bottom property\n\t\t\t\tthis.top = this.watchItem.top;\n\t\t\t\tthis.bottom = this.watchItem.bottom;\n\t\t\t}\n\n\t\t\tthis.top -= this.offsets.top;\n\t\t\tthis.bottom += this.offsets.bottom;\n\t\t\tthis.height = this.bottom - this.top;\n\n\t\t\tif ( (previousTop !== undefined || previousBottom !== undefined) && (this.top !== previousTop || this.bottom !== previousBottom) ) {\n\t\t\t\ttriggerCallbackArray( this.callbacks[LOCATIONCHANGE] );\n\t\t\t}\n\t\t};\n\n\t\tthis.recalculateLocation();\n\t\tthis.update();\n\n\t\twasInViewport = this.isInViewport;\n\t\twasFullyInViewport = this.isFullyInViewport;\n\t\twasAboveViewport = this.isAboveViewport;\n\t\twasBelowViewport = this.isBelowViewport;\n\t}\n\n\tElementWatcher.prototype = {\n\t\ton: function( event, callback, isOne ) {\n\n\t\t\t// trigger the event if it applies to the element right now.\n\t\t\tswitch( true ) {\n\t\t\t\tcase event === VISIBILITYCHANGE && !this.isInViewport && this.isAboveViewport:\n\t\t\t\tcase event === ENTERVIEWPORT && this.isInViewport:\n\t\t\t\tcase event === FULLYENTERVIEWPORT && this.isFullyInViewport:\n\t\t\t\tcase event === EXITVIEWPORT && this.isAboveViewport && !this.isInViewport:\n\t\t\t\tcase event === PARTIALLYEXITVIEWPORT && this.isAboveViewport:\n\t\t\t\t\tcallback.call( this, latestEvent );\n\t\t\t\t\tif (isOne) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (this.callbacks[event]) {\n\t\t\t\tthis.callbacks[event].push({callback: callback, isOne: isOne||false});\n\t\t\t} else {\n\t\t\t\tthrow new Error('Tried to add a scroll monitor listener of type '+event+'. Your options are: '+eventTypes.join(', '));\n\t\t\t}\n\t\t},\n\t\toff: function( event, callback ) {\n\t\t\tif (this.callbacks[event]) {\n\t\t\t\tfor (var i = 0, item; item = this.callbacks[event][i]; i++) {\n\t\t\t\t\tif (item.callback === callback) {\n\t\t\t\t\t\tthis.callbacks[event].splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthrow new Error('Tried to remove a scroll monitor listener of type '+event+'. Your options are: '+eventTypes.join(', '));\n\t\t\t}\n\t\t},\n\t\tone: function( event, callback ) {\n\t\t\tthis.on( event, callback, true);\n\t\t},\n\t\trecalculateSize: function() {\n\t\t\tthis.height = this.watchItem.offsetHeight + this.offsets.top + this.offsets.bottom;\n\t\t\tthis.bottom = this.top + this.height;\n\t\t},\n\t\tupdate: function() {\n\t\t\tthis.isAboveViewport = this.top < exports.viewportTop;\n\t\t\tthis.isBelowViewport = this.bottom > exports.viewportBottom;\n\n\t\t\tthis.isInViewport = (this.top <= exports.viewportBottom && this.bottom >= exports.viewportTop);\n\t\t\tthis.isFullyInViewport = (this.top >= exports.viewportTop && this.bottom <= exports.viewportBottom) ||\n\t\t\t\t\t\t\t\t (this.isAboveViewport && this.isBelowViewport);\n\n\t\t},\n\t\tdestroy: function() {\n\t\t\tvar index = watchers.indexOf(this),\n\t\t\t\tself  = this;\n\t\t\twatchers.splice(index, 1);\n\t\t\tfor (var i = 0, j = eventTypes.length; i < j; i++) {\n\t\t\t\tself.callbacks[eventTypes[i]].length = 0;\n\t\t\t}\n\t\t},\n\t\t// prevent recalculating the element location\n\t\tlock: function() {\n\t\t\tthis.locked = true;\n\t\t},\n\t\tunlock: function() {\n\t\t\tthis.locked = false;\n\t\t}\n\t};\n\n\tvar eventHandlerFactory = function (type) {\n\t\treturn function( callback, isOne ) {\n\t\t\tthis.on.call(this, type, callback, isOne);\n\t\t};\n\t};\n\n\tfor (var i = 0, j = eventTypes.length; i < j; i++) {\n\t\tvar type =  eventTypes[i];\n\t\tElementWatcher.prototype[type] = eventHandlerFactory(type);\n\t}\n\n\ttry {\n\t\tcalculateViewport();\n\t} catch (e) {\n\t\ttry {\n\t\t\twindow.$(calculateViewport);\n\t\t} catch (e) {\n\t\t\tthrow new Error('If you must put scrollMonitor in the <head>, you must use jQuery.');\n\t\t}\n\t}\n\n\tfunction scrollMonitorListener(event) {\n\t\tlatestEvent = event;\n\t\tcalculateViewport();\n\t\tupdateAndTriggerWatchers();\n\t}\n\n\tif (window.addEventListener) {\n\t\twindow.addEventListener('scroll', scrollMonitorListener);\n\t\twindow.addEventListener('resize', debouncedRecalcuateAndTrigger);\n\t} else {\n\t\t// Old IE support\n\t\twindow.attachEvent('onscroll', scrollMonitorListener);\n\t\twindow.attachEvent('onresize', debouncedRecalcuateAndTrigger);\n\t}\n\n\texports.beget = exports.create = function( element, offsets ) {\n\t\tif (typeof element === 'string') {\n\t\t\telement = document.querySelector(element);\n\t\t} else if (element && element.length > 0) {\n\t\t\telement = element[0];\n\t\t}\n\n\t\tvar watcher = new ElementWatcher( element, offsets );\n\t\twatchers.push(watcher);\n\t\twatcher.update();\n\t\treturn watcher;\n\t};\n\n\texports.update = function() {\n\t\tlatestEvent = null;\n\t\tcalculateViewport();\n\t\tupdateAndTriggerWatchers();\n\t};\n\texports.recalculateLocations = function() {\n\t\texports.documentHeight = 0;\n\t\texports.update();\n\t};\n\n\treturn exports;\n});\n"]}